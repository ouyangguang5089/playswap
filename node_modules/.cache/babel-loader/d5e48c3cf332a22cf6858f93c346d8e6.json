{"ast":null,"code":"\"use strict\"; // Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\n\nvar _classCallCheck = require(\"/projects/testswap/uniswap-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/projects/testswap/uniswap-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  }\n  result[\"default\"] = mod;\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar bind_decorator_1 = __importDefault(require(\"bind-decorator\"));\n\nvar crypto_1 = __importDefault(require(\"crypto\"));\n\nvar rxjs_1 = require(\"rxjs\");\n\nvar operators_1 = require(\"rxjs/operators\");\n\nvar url_1 = __importDefault(require(\"url\"));\n\nvar LinkFlow_1 = require(\"../components/LinkFlow\");\n\nvar Snackbar_1 = require(\"../components/Snackbar\");\n\nvar WalletLinkConnection_1 = require(\"../connection/WalletLinkConnection\");\n\nvar ScopedLocalStorage_1 = require(\"../lib/ScopedLocalStorage\");\n\nvar util_1 = require(\"../util\");\n\nvar aes256gcm = __importStar(require(\"./aes256gcm\"));\n\nvar Session_1 = require(\"./Session\");\n\nvar Web3Method_1 = require(\"./Web3Method\");\n\nvar Web3RequestCanceledMessage_1 = require(\"./Web3RequestCanceledMessage\");\n\nvar Web3RequestMessage_1 = require(\"./Web3RequestMessage\");\n\nvar Web3Response_1 = require(\"./Web3Response\");\n\nvar Web3ResponseMessage_1 = require(\"./Web3ResponseMessage\");\n\nvar WalletLinkRelay = /*#__PURE__*/function () {\n  function WalletLinkRelay(options) {\n    _classCallCheck(this, WalletLinkRelay);\n\n    this.appName = \"\";\n    this.appLogoUrl = null;\n    this.attached = false;\n    this.walletLinkUrl = options.walletLinkUrl;\n    var u = url_1.default.parse(this.walletLinkUrl);\n    this.walletLinkOrigin = \"\".concat(u.protocol, \"//\").concat(u.host);\n    this.storage = new ScopedLocalStorage_1.ScopedLocalStorage(\"-walletlink:\".concat(this.walletLinkOrigin));\n    this.session = Session_1.Session.load(this.storage) || new Session_1.Session(this.storage).save();\n    this.connection = new WalletLinkConnection_1.WalletLinkConnection(this.session.id, this.session.key, this.walletLinkUrl);\n    this.connection.incomingEvent$.pipe(operators_1.filter(function (m) {\n      return m.event === \"Web3Response\";\n    })).subscribe({\n      next: this.handleIncomingEvent\n    }); // if session is marked destroyed, reset and reload\n\n    this.connection.sessionConfig$.pipe(operators_1.filter(function (c) {\n      return !!c.metadata && c.metadata.__destroyed === \"1\";\n    })).subscribe({\n      next: this.resetAndReload\n    });\n    this.snackbar = new Snackbar_1.Snackbar({\n      darkMode: options.darkMode\n    });\n    this.linkFlow = new LinkFlow_1.LinkFlow({\n      darkMode: options.darkMode,\n      version: options.version,\n      sessionId: this.session.id,\n      sessionSecret: this.session.secret,\n      walletLinkUrl: this.walletLinkUrl,\n      connected$: this.connection.connected$\n    });\n    this.connection.connect();\n  }\n\n  _createClass(WalletLinkRelay, [{\n    key: \"resetAndReload\",\n    value: function resetAndReload() {\n      var _this = this;\n\n      this.connection.setSessionMetadata(\"__destroyed\", \"1\").pipe(operators_1.timeout(1000), operators_1.catchError(function (_) {\n        return rxjs_1.of(null);\n      })).subscribe(function (_) {\n        _this.connection.destroy();\n\n        _this.storage.clear();\n\n        document.location.reload();\n      });\n    }\n  }, {\n    key: \"setAppInfo\",\n    value: function setAppInfo(appName, appLogoUrl) {\n      this.appName = appName;\n      this.appLogoUrl = appLogoUrl;\n    }\n  }, {\n    key: \"attach\",\n    value: function attach(el) {\n      if (this.attached) {\n        throw new Error(\"WalletLinkRelay is already attached\");\n      }\n\n      var container = document.createElement(\"div\");\n      container.className = \"-walletlink-css-reset\";\n      el.appendChild(container);\n      this.linkFlow.attach(container);\n      this.snackbar.attach(container);\n    }\n  }, {\n    key: \"getStorageItem\",\n    value: function getStorageItem(key) {\n      return this.storage.getItem(key);\n    }\n  }, {\n    key: \"setStorageItem\",\n    value: function setStorageItem(key, value) {\n      this.storage.setItem(key, value);\n    }\n  }, {\n    key: \"requestEthereumAccounts\",\n    value: function requestEthereumAccounts() {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.requestEthereumAccounts,\n        params: {\n          appName: this.appName,\n          appLogoUrl: this.appLogoUrl || null\n        }\n      });\n    }\n  }, {\n    key: \"signEthereumMessage\",\n    value: function signEthereumMessage(message, address, addPrefix, typedDataJson) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumMessage,\n        params: {\n          message: util_1.hexStringFromBuffer(message, true),\n          address: address,\n          addPrefix: addPrefix,\n          typedDataJson: typedDataJson || null\n        }\n      });\n    }\n  }, {\n    key: \"ethereumAddressFromSignedMessage\",\n    value: function ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.ethereumAddressFromSignedMessage,\n        params: {\n          message: util_1.hexStringFromBuffer(message, true),\n          signature: util_1.hexStringFromBuffer(signature, true),\n          addPrefix: addPrefix\n        }\n      });\n    }\n  }, {\n    key: \"signEthereumTransaction\",\n    value: function signEthereumTransaction(params) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumTransaction,\n        params: {\n          fromAddress: params.fromAddress,\n          toAddress: params.toAddress,\n          weiValue: util_1.bigIntStringFromBN(params.weiValue),\n          data: util_1.hexStringFromBuffer(params.data, true),\n          nonce: params.nonce,\n          gasPriceInWei: params.gasPriceInWei ? util_1.bigIntStringFromBN(params.gasPriceInWei) : null,\n          gasLimit: params.gasLimit ? util_1.bigIntStringFromBN(params.gasLimit) : null,\n          chainId: params.chainId,\n          shouldSubmit: false\n        }\n      });\n    }\n  }, {\n    key: \"signAndSubmitEthereumTransaction\",\n    value: function signAndSubmitEthereumTransaction(params) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumTransaction,\n        params: {\n          fromAddress: params.fromAddress,\n          toAddress: params.toAddress,\n          weiValue: util_1.bigIntStringFromBN(params.weiValue),\n          data: util_1.hexStringFromBuffer(params.data, true),\n          nonce: params.nonce,\n          gasPriceInWei: params.gasPriceInWei ? util_1.bigIntStringFromBN(params.gasPriceInWei) : null,\n          gasLimit: params.gasLimit ? util_1.bigIntStringFromBN(params.gasLimit) : null,\n          chainId: params.chainId,\n          shouldSubmit: true\n        }\n      });\n    }\n  }, {\n    key: \"submitEthereumTransaction\",\n    value: function submitEthereumTransaction(signedTransaction, chainId) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.submitEthereumTransaction,\n        params: {\n          signedTransaction: util_1.hexStringFromBuffer(signedTransaction, true),\n          chainId: chainId\n        }\n      });\n    }\n  }, {\n    key: \"scanQRCode\",\n    value: function scanQRCode(regExp) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.scanQRCode,\n        params: {\n          regExp: regExp\n        }\n      });\n    }\n  }, {\n    key: \"arbitraryRequest\",\n    value: function arbitraryRequest(data) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.arbitrary,\n        params: {\n          data: data\n        }\n      });\n    }\n  }, {\n    key: \"sendRequest\",\n    value: function sendRequest(request) {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        var hideSnackbarItem = null;\n        var id = crypto_1.default.randomBytes(8).toString(\"hex\");\n        var isRequestAccounts = request.method === Web3Method_1.Web3Method.requestEthereumAccounts;\n\n        var cancel = function cancel() {\n          _this2.publishWeb3RequestCanceledEvent(id);\n\n          _this2.handleWeb3ResponseMessage(Web3ResponseMessage_1.Web3ResponseMessage({\n            id: id,\n            response: Web3Response_1.ErrorResponse(request.method, \"User rejected request\")\n          }));\n\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n\n        if (isRequestAccounts) {\n          _this2.linkFlow.open({\n            onCancel: cancel\n          });\n\n          WalletLinkRelay.accountRequestCallbackIds.add(id);\n        } else {\n          var snackbarProps = {\n            message: \"Pushed a request to your wallet...\",\n            showProgressBar: true,\n            actions: [{\n              info: \"Made a mistake?\",\n              buttonLabel: \"Cancel\",\n              onClick: cancel\n            }, {\n              info: \"Not receiving requests?\",\n              buttonLabel: \"Reset Connection\",\n              onClick: _this2.resetAndReload\n            }]\n          };\n          hideSnackbarItem = _this2.snackbar.presentItem(snackbarProps);\n        }\n\n        WalletLinkRelay.callbacks.set(id, function (response) {\n          _this2.linkFlow.close();\n\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n\n          resolve(response);\n        });\n\n        _this2.publishWeb3RequestEvent(id, request);\n      });\n    }\n  }, {\n    key: \"publishWeb3RequestEvent\",\n    value: function publishWeb3RequestEvent(id, request) {\n      var _this3 = this;\n\n      var message = Web3RequestMessage_1.Web3RequestMessage({\n        id: id,\n        request: request\n      });\n      this.publishEvent(\"Web3Request\", message, true).subscribe({\n        error: function error(err) {\n          _this3.handleWeb3ResponseMessage(Web3ResponseMessage_1.Web3ResponseMessage({\n            id: message.id,\n            response: {\n              method: message.request.method,\n              errorMessage: err.message\n            }\n          }));\n        }\n      });\n    }\n  }, {\n    key: \"publishWeb3RequestCanceledEvent\",\n    value: function publishWeb3RequestCanceledEvent(id) {\n      var message = Web3RequestCanceledMessage_1.Web3RequestCanceledMessage(id);\n      this.publishEvent(\"Web3RequestCanceled\", message, false).subscribe();\n    }\n  }, {\n    key: \"publishEvent\",\n    value: function publishEvent(event, message, callWebhook) {\n      var encrypted = aes256gcm.encrypt(JSON.stringify(Object.assign(Object.assign({}, message), {\n        origin: location.origin\n      })), this.session.secret);\n      return this.connection.publishEvent(event, encrypted, callWebhook);\n    }\n  }, {\n    key: \"handleIncomingEvent\",\n    value: function handleIncomingEvent(event) {\n      var json;\n\n      try {\n        json = JSON.parse(aes256gcm.decrypt(event.data, this.session.secret));\n      } catch (_a) {\n        return;\n      }\n\n      var message = Web3ResponseMessage_1.isWeb3ResponseMessage(json) ? json : null;\n\n      if (!message) {\n        return;\n      }\n\n      this.handleWeb3ResponseMessage(message);\n    }\n  }, {\n    key: \"handleWeb3ResponseMessage\",\n    value: function handleWeb3ResponseMessage(message) {\n      var _this4 = this;\n\n      var response = message.response;\n\n      if (Web3Response_1.isRequestEthereumAccountsResponse(response)) {\n        Array.from(WalletLinkRelay.accountRequestCallbackIds.values()).forEach(function (id) {\n          return _this4.invokeCallback(Object.assign(Object.assign({}, message), {\n            id: id\n          }));\n        });\n        WalletLinkRelay.accountRequestCallbackIds.clear();\n        return;\n      }\n\n      this.invokeCallback(message);\n    }\n  }, {\n    key: \"invokeCallback\",\n    value: function invokeCallback(message) {\n      var callback = WalletLinkRelay.callbacks.get(message.id);\n\n      if (callback) {\n        callback(message.response);\n        WalletLinkRelay.callbacks.delete(message.id);\n      }\n    }\n  }]);\n\n  return WalletLinkRelay;\n}();\n\nWalletLinkRelay.callbacks = new Map();\nWalletLinkRelay.accountRequestCallbackIds = new Set();\n\n__decorate([bind_decorator_1.default], WalletLinkRelay.prototype, \"resetAndReload\", null);\n\n__decorate([bind_decorator_1.default], WalletLinkRelay.prototype, \"handleIncomingEvent\", null);\n\nexports.WalletLinkRelay = WalletLinkRelay;","map":{"version":3,"sources":["/projects/testswap/uniswap-interface/node_modules/walletlink/dist/relay/WalletLinkRelay.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__importDefault","mod","__esModule","__importStar","result","k","hasOwnProperty","call","exports","value","bind_decorator_1","require","crypto_1","rxjs_1","operators_1","url_1","LinkFlow_1","Snackbar_1","WalletLinkConnection_1","ScopedLocalStorage_1","util_1","aes256gcm","Session_1","Web3Method_1","Web3RequestCanceledMessage_1","Web3RequestMessage_1","Web3Response_1","Web3ResponseMessage_1","WalletLinkRelay","options","appName","appLogoUrl","attached","walletLinkUrl","u","default","parse","walletLinkOrigin","protocol","host","storage","ScopedLocalStorage","session","Session","load","save","connection","WalletLinkConnection","id","incomingEvent$","pipe","filter","m","event","subscribe","next","handleIncomingEvent","sessionConfig$","metadata","__destroyed","resetAndReload","snackbar","Snackbar","darkMode","linkFlow","LinkFlow","version","sessionId","sessionSecret","secret","connected$","connect","setSessionMetadata","timeout","catchError","_","of","destroy","clear","document","location","reload","el","Error","container","createElement","className","appendChild","attach","getItem","setItem","sendRequest","method","Web3Method","requestEthereumAccounts","params","message","address","addPrefix","typedDataJson","signEthereumMessage","hexStringFromBuffer","signature","ethereumAddressFromSignedMessage","signEthereumTransaction","fromAddress","toAddress","weiValue","bigIntStringFromBN","data","nonce","gasPriceInWei","gasLimit","chainId","shouldSubmit","signedTransaction","submitEthereumTransaction","regExp","scanQRCode","arbitrary","request","Promise","resolve","reject","hideSnackbarItem","randomBytes","toString","isRequestAccounts","cancel","publishWeb3RequestCanceledEvent","handleWeb3ResponseMessage","Web3ResponseMessage","response","ErrorResponse","open","onCancel","accountRequestCallbackIds","add","snackbarProps","showProgressBar","actions","info","buttonLabel","onClick","presentItem","callbacks","set","close","errorMessage","publishWeb3RequestEvent","Web3RequestMessage","publishEvent","error","err","Web3RequestCanceledMessage","callWebhook","encrypted","encrypt","JSON","stringify","assign","origin","json","decrypt","_a","isWeb3ResponseMessage","isRequestEthereumAccountsResponse","Array","from","values","forEach","invokeCallback","callback","get","delete","Map","Set","prototype"],"mappings":"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","sourcesContent":["\"use strict\";\n// Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst bind_decorator_1 = __importDefault(require(\"bind-decorator\"));\nconst crypto_1 = __importDefault(require(\"crypto\"));\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst url_1 = __importDefault(require(\"url\"));\nconst LinkFlow_1 = require(\"../components/LinkFlow\");\nconst Snackbar_1 = require(\"../components/Snackbar\");\nconst WalletLinkConnection_1 = require(\"../connection/WalletLinkConnection\");\nconst ScopedLocalStorage_1 = require(\"../lib/ScopedLocalStorage\");\nconst util_1 = require(\"../util\");\nconst aes256gcm = __importStar(require(\"./aes256gcm\"));\nconst Session_1 = require(\"./Session\");\nconst Web3Method_1 = require(\"./Web3Method\");\nconst Web3RequestCanceledMessage_1 = require(\"./Web3RequestCanceledMessage\");\nconst Web3RequestMessage_1 = require(\"./Web3RequestMessage\");\nconst Web3Response_1 = require(\"./Web3Response\");\nconst Web3ResponseMessage_1 = require(\"./Web3ResponseMessage\");\nclass WalletLinkRelay {\n    constructor(options) {\n        this.appName = \"\";\n        this.appLogoUrl = null;\n        this.attached = false;\n        this.walletLinkUrl = options.walletLinkUrl;\n        const u = url_1.default.parse(this.walletLinkUrl);\n        this.walletLinkOrigin = `${u.protocol}//${u.host}`;\n        this.storage = new ScopedLocalStorage_1.ScopedLocalStorage(`-walletlink:${this.walletLinkOrigin}`);\n        this.session =\n            Session_1.Session.load(this.storage) || new Session_1.Session(this.storage).save();\n        this.connection = new WalletLinkConnection_1.WalletLinkConnection(this.session.id, this.session.key, this.walletLinkUrl);\n        this.connection.incomingEvent$\n            .pipe(operators_1.filter(m => m.event === \"Web3Response\"))\n            .subscribe({ next: this.handleIncomingEvent });\n        // if session is marked destroyed, reset and reload\n        this.connection.sessionConfig$\n            .pipe(operators_1.filter(c => !!c.metadata && c.metadata.__destroyed === \"1\"))\n            .subscribe({ next: this.resetAndReload });\n        this.snackbar = new Snackbar_1.Snackbar({\n            darkMode: options.darkMode\n        });\n        this.linkFlow = new LinkFlow_1.LinkFlow({\n            darkMode: options.darkMode,\n            version: options.version,\n            sessionId: this.session.id,\n            sessionSecret: this.session.secret,\n            walletLinkUrl: this.walletLinkUrl,\n            connected$: this.connection.connected$\n        });\n        this.connection.connect();\n    }\n    resetAndReload() {\n        this.connection\n            .setSessionMetadata(\"__destroyed\", \"1\")\n            .pipe(operators_1.timeout(1000), operators_1.catchError(_ => rxjs_1.of(null)))\n            .subscribe(_ => {\n            this.connection.destroy();\n            this.storage.clear();\n            document.location.reload();\n        });\n    }\n    setAppInfo(appName, appLogoUrl) {\n        this.appName = appName;\n        this.appLogoUrl = appLogoUrl;\n    }\n    attach(el) {\n        if (this.attached) {\n            throw new Error(\"WalletLinkRelay is already attached\");\n        }\n        const container = document.createElement(\"div\");\n        container.className = \"-walletlink-css-reset\";\n        el.appendChild(container);\n        this.linkFlow.attach(container);\n        this.snackbar.attach(container);\n    }\n    getStorageItem(key) {\n        return this.storage.getItem(key);\n    }\n    setStorageItem(key, value) {\n        this.storage.setItem(key, value);\n    }\n    requestEthereumAccounts() {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.requestEthereumAccounts,\n            params: {\n                appName: this.appName,\n                appLogoUrl: this.appLogoUrl || null\n            }\n        });\n    }\n    signEthereumMessage(message, address, addPrefix, typedDataJson) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumMessage,\n            params: {\n                message: util_1.hexStringFromBuffer(message, true),\n                address,\n                addPrefix,\n                typedDataJson: typedDataJson || null\n            }\n        });\n    }\n    ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.ethereumAddressFromSignedMessage,\n            params: {\n                message: util_1.hexStringFromBuffer(message, true),\n                signature: util_1.hexStringFromBuffer(signature, true),\n                addPrefix\n            }\n        });\n    }\n    signEthereumTransaction(params) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumTransaction,\n            params: {\n                fromAddress: params.fromAddress,\n                toAddress: params.toAddress,\n                weiValue: util_1.bigIntStringFromBN(params.weiValue),\n                data: util_1.hexStringFromBuffer(params.data, true),\n                nonce: params.nonce,\n                gasPriceInWei: params.gasPriceInWei\n                    ? util_1.bigIntStringFromBN(params.gasPriceInWei)\n                    : null,\n                gasLimit: params.gasLimit ? util_1.bigIntStringFromBN(params.gasLimit) : null,\n                chainId: params.chainId,\n                shouldSubmit: false\n            }\n        });\n    }\n    signAndSubmitEthereumTransaction(params) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumTransaction,\n            params: {\n                fromAddress: params.fromAddress,\n                toAddress: params.toAddress,\n                weiValue: util_1.bigIntStringFromBN(params.weiValue),\n                data: util_1.hexStringFromBuffer(params.data, true),\n                nonce: params.nonce,\n                gasPriceInWei: params.gasPriceInWei\n                    ? util_1.bigIntStringFromBN(params.gasPriceInWei)\n                    : null,\n                gasLimit: params.gasLimit ? util_1.bigIntStringFromBN(params.gasLimit) : null,\n                chainId: params.chainId,\n                shouldSubmit: true\n            }\n        });\n    }\n    submitEthereumTransaction(signedTransaction, chainId) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.submitEthereumTransaction,\n            params: {\n                signedTransaction: util_1.hexStringFromBuffer(signedTransaction, true),\n                chainId\n            }\n        });\n    }\n    scanQRCode(regExp) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.scanQRCode,\n            params: { regExp }\n        });\n    }\n    arbitraryRequest(data) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.arbitrary,\n            params: { data }\n        });\n    }\n    sendRequest(request) {\n        return new Promise((resolve, reject) => {\n            let hideSnackbarItem = null;\n            const id = crypto_1.default.randomBytes(8).toString(\"hex\");\n            const isRequestAccounts = request.method === Web3Method_1.Web3Method.requestEthereumAccounts;\n            const cancel = () => {\n                this.publishWeb3RequestCanceledEvent(id);\n                this.handleWeb3ResponseMessage(Web3ResponseMessage_1.Web3ResponseMessage({\n                    id,\n                    response: Web3Response_1.ErrorResponse(request.method, \"User rejected request\")\n                }));\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n            };\n            if (isRequestAccounts) {\n                this.linkFlow.open({ onCancel: cancel });\n                WalletLinkRelay.accountRequestCallbackIds.add(id);\n            }\n            else {\n                const snackbarProps = {\n                    message: \"Pushed a request to your wallet...\",\n                    showProgressBar: true,\n                    actions: [\n                        {\n                            info: \"Made a mistake?\",\n                            buttonLabel: \"Cancel\",\n                            onClick: cancel\n                        },\n                        {\n                            info: \"Not receiving requests?\",\n                            buttonLabel: \"Reset Connection\",\n                            onClick: this.resetAndReload\n                        }\n                    ]\n                };\n                hideSnackbarItem = this.snackbar.presentItem(snackbarProps);\n            }\n            WalletLinkRelay.callbacks.set(id, response => {\n                this.linkFlow.close();\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            this.publishWeb3RequestEvent(id, request);\n        });\n    }\n    publishWeb3RequestEvent(id, request) {\n        const message = Web3RequestMessage_1.Web3RequestMessage({ id, request });\n        this.publishEvent(\"Web3Request\", message, true).subscribe({\n            error: err => {\n                this.handleWeb3ResponseMessage(Web3ResponseMessage_1.Web3ResponseMessage({\n                    id: message.id,\n                    response: {\n                        method: message.request.method,\n                        errorMessage: err.message\n                    }\n                }));\n            }\n        });\n    }\n    publishWeb3RequestCanceledEvent(id) {\n        const message = Web3RequestCanceledMessage_1.Web3RequestCanceledMessage(id);\n        this.publishEvent(\"Web3RequestCanceled\", message, false).subscribe();\n    }\n    publishEvent(event, message, callWebhook) {\n        const encrypted = aes256gcm.encrypt(JSON.stringify(Object.assign(Object.assign({}, message), { origin: location.origin })), this.session.secret);\n        return this.connection.publishEvent(event, encrypted, callWebhook);\n    }\n    handleIncomingEvent(event) {\n        let json;\n        try {\n            json = JSON.parse(aes256gcm.decrypt(event.data, this.session.secret));\n        }\n        catch (_a) {\n            return;\n        }\n        const message = Web3ResponseMessage_1.isWeb3ResponseMessage(json) ? json : null;\n        if (!message) {\n            return;\n        }\n        this.handleWeb3ResponseMessage(message);\n    }\n    handleWeb3ResponseMessage(message) {\n        const { response } = message;\n        if (Web3Response_1.isRequestEthereumAccountsResponse(response)) {\n            Array.from(WalletLinkRelay.accountRequestCallbackIds.values()).forEach(id => this.invokeCallback(Object.assign(Object.assign({}, message), { id })));\n            WalletLinkRelay.accountRequestCallbackIds.clear();\n            return;\n        }\n        this.invokeCallback(message);\n    }\n    invokeCallback(message) {\n        const callback = WalletLinkRelay.callbacks.get(message.id);\n        if (callback) {\n            callback(message.response);\n            WalletLinkRelay.callbacks.delete(message.id);\n        }\n    }\n}\nWalletLinkRelay.callbacks = new Map();\nWalletLinkRelay.accountRequestCallbackIds = new Set();\n__decorate([\n    bind_decorator_1.default\n], WalletLinkRelay.prototype, \"resetAndReload\", null);\n__decorate([\n    bind_decorator_1.default\n], WalletLinkRelay.prototype, \"handleIncomingEvent\", null);\nexports.WalletLinkRelay = WalletLinkRelay;\n"]},"metadata":{},"sourceType":"script"}