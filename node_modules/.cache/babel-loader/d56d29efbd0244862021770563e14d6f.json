{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/objectSpread\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport * as utils from './utils.js';\nimport baseLogger from './logger.js';\nimport EventEmitter from './EventEmitter.js';\n\nfunction remove(arr, what) {\n  var found = arr.indexOf(what);\n\n  while (found !== -1) {\n    arr.splice(found, 1);\n    found = arr.indexOf(what);\n  }\n}\n\nvar Connector = /*#__PURE__*/function (_EventEmitter) {\n  _inherits(Connector, _EventEmitter);\n\n  function Connector(backend, store, services) {\n    var _this;\n\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\n    _classCallCheck(this, Connector);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Connector).call(this));\n    EventEmitter.call(_assertThisInitialized(_assertThisInitialized(_this))); // <=IE10 fix (unable to call parent constructor)\n\n    _this.backend = backend;\n    _this.store = store;\n    _this.languageUtils = services.languageUtils;\n    _this.options = options;\n    _this.logger = baseLogger.create('backendConnector');\n    _this.state = {};\n    _this.queue = [];\n\n    if (_this.backend && _this.backend.init) {\n      _this.backend.init(services, options.backend, options);\n    }\n\n    return _this;\n  }\n\n  _createClass(Connector, [{\n    key: \"queueLoad\",\n    value: function queueLoad(languages, namespaces, options, callback) {\n      var _this2 = this; // find what needs to be loaded\n\n\n      var toLoad = [];\n      var pending = [];\n      var toLoadLanguages = [];\n      var toLoadNamespaces = [];\n      languages.forEach(function (lng) {\n        var hasAllNamespaces = true;\n        namespaces.forEach(function (ns) {\n          var name = \"\".concat(lng, \"|\").concat(ns);\n\n          if (!options.reload && _this2.store.hasResourceBundle(lng, ns)) {\n            _this2.state[name] = 2; // loaded\n          } else if (_this2.state[name] < 0) {// nothing to do for err\n          } else if (_this2.state[name] === 1) {\n            if (pending.indexOf(name) < 0) pending.push(name);\n          } else {\n            _this2.state[name] = 1; // pending\n\n            hasAllNamespaces = false;\n            if (pending.indexOf(name) < 0) pending.push(name);\n            if (toLoad.indexOf(name) < 0) toLoad.push(name);\n            if (toLoadNamespaces.indexOf(ns) < 0) toLoadNamespaces.push(ns);\n          }\n        });\n        if (!hasAllNamespaces) toLoadLanguages.push(lng);\n      });\n\n      if (toLoad.length || pending.length) {\n        this.queue.push({\n          pending: pending,\n          loaded: {},\n          errors: [],\n          callback: callback\n        });\n      }\n\n      return {\n        toLoad: toLoad,\n        pending: pending,\n        toLoadLanguages: toLoadLanguages,\n        toLoadNamespaces: toLoadNamespaces\n      };\n    }\n  }, {\n    key: \"loaded\",\n    value: function loaded(name, err, data) {\n      var _name$split = name.split('|'),\n          _name$split2 = _slicedToArray(_name$split, 2),\n          lng = _name$split2[0],\n          ns = _name$split2[1];\n\n      if (err) this.emit('failedLoading', lng, ns, err);\n\n      if (data) {\n        this.store.addResourceBundle(lng, ns, data);\n      } // set loaded\n\n\n      this.state[name] = err ? -1 : 2; // consolidated loading done in this run - only emit once for a loaded namespace\n\n      var loaded = {}; // callback if ready\n\n      this.queue.forEach(function (q) {\n        utils.pushPath(q.loaded, [lng], ns);\n        remove(q.pending, name);\n        if (err) q.errors.push(err);\n\n        if (q.pending.length === 0 && !q.done) {\n          // only do once per loaded -> this.emit('loaded', q.loaded);\n          Object.keys(q.loaded).forEach(function (l) {\n            if (!loaded[l]) loaded[l] = [];\n\n            if (q.loaded[l].length) {\n              q.loaded[l].forEach(function (ns) {\n                if (loaded[l].indexOf(ns) < 0) loaded[l].push(ns);\n              });\n            }\n          });\n          /* eslint no-param-reassign: 0 */\n\n          q.done = true;\n\n          if (q.errors.length) {\n            q.callback(q.errors);\n          } else {\n            q.callback();\n          }\n        }\n      }); // emit consolidated loaded event\n\n      this.emit('loaded', loaded); // remove done load requests\n\n      this.queue = this.queue.filter(function (q) {\n        return !q.done;\n      });\n    }\n  }, {\n    key: \"read\",\n    value: function read(lng, ns, fcName) {\n      var _this3 = this;\n\n      var tried = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var wait = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 250;\n      var callback = arguments.length > 5 ? arguments[5] : undefined;\n      if (!lng.length) return callback(null, {}); // noting to load\n\n      return this.backend[fcName](lng, ns, function (err, data) {\n        if (err && data\n        /* = retryFlag */\n        && tried < 5) {\n          setTimeout(function () {\n            _this3.read.call(_this3, lng, ns, fcName, tried + 1, wait * 2, callback);\n          }, wait);\n          return;\n        }\n\n        callback(err, data);\n      });\n    }\n    /* eslint consistent-return: 0 */\n\n  }, {\n    key: \"prepareLoading\",\n    value: function prepareLoading(languages, namespaces) {\n      var _this4 = this;\n\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var callback = arguments.length > 3 ? arguments[3] : undefined;\n\n      if (!this.backend) {\n        this.logger.warn('No backend was added via i18next.use. Will not load resources.');\n        return callback && callback();\n      }\n\n      if (typeof languages === 'string') languages = this.languageUtils.toResolveHierarchy(languages);\n      if (typeof namespaces === 'string') namespaces = [namespaces];\n      var toLoad = this.queueLoad(languages, namespaces, options, callback);\n\n      if (!toLoad.toLoad.length) {\n        if (!toLoad.pending.length) callback(); // nothing to load and no pendings...callback now\n\n        return null; // pendings will trigger callback\n      }\n\n      toLoad.toLoad.forEach(function (name) {\n        _this4.loadOne(name);\n      });\n    }\n  }, {\n    key: \"load\",\n    value: function load(languages, namespaces, callback) {\n      this.prepareLoading(languages, namespaces, {}, callback);\n    }\n  }, {\n    key: \"reload\",\n    value: function reload(languages, namespaces, callback) {\n      this.prepareLoading(languages, namespaces, {\n        reload: true\n      }, callback);\n    }\n  }, {\n    key: \"loadOne\",\n    value: function loadOne(name) {\n      var _this5 = this;\n\n      var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n      var _name$split3 = name.split('|'),\n          _name$split4 = _slicedToArray(_name$split3, 2),\n          lng = _name$split4[0],\n          ns = _name$split4[1];\n\n      this.read(lng, ns, 'read', null, null, function (err, data) {\n        if (err) _this5.logger.warn(\"\".concat(prefix, \"loading namespace \").concat(ns, \" for language \").concat(lng, \" failed\"), err);\n        if (!err && data) _this5.logger.log(\"\".concat(prefix, \"loaded namespace \").concat(ns, \" for language \").concat(lng), data);\n\n        _this5.loaded(name, err, data);\n      });\n    }\n  }, {\n    key: \"saveMissing\",\n    value: function saveMissing(languages, namespace, key, fallbackValue, isUpdate) {\n      var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n\n      if (this.backend && this.backend.create) {\n        this.backend.create(languages, namespace, key, fallbackValue, null\n        /* unused callback */\n        , _objectSpread({}, options, {\n          isUpdate: isUpdate\n        }));\n      } // write to store to avoid resending\n\n\n      if (!languages || !languages[0]) return;\n      this.store.addResource(languages[0], namespace, key, fallbackValue);\n    }\n  }]);\n\n  return Connector;\n}(EventEmitter);\n\nexport default Connector;","map":{"version":3,"sources":["/projects/testswap/uniswap-interface/node_modules/i18next/dist/es/BackendConnector.js"],"names":["_objectSpread","_slicedToArray","_classCallCheck","_createClass","_possibleConstructorReturn","_getPrototypeOf","_inherits","_assertThisInitialized","utils","baseLogger","EventEmitter","remove","arr","what","found","indexOf","splice","Connector","_EventEmitter","backend","store","services","_this","options","arguments","length","undefined","call","languageUtils","logger","create","state","queue","init","key","value","queueLoad","languages","namespaces","callback","_this2","toLoad","pending","toLoadLanguages","toLoadNamespaces","forEach","lng","hasAllNamespaces","ns","name","concat","reload","hasResourceBundle","push","loaded","errors","err","data","_name$split","split","_name$split2","emit","addResourceBundle","q","pushPath","done","Object","keys","l","filter","read","fcName","_this3","tried","wait","setTimeout","prepareLoading","_this4","warn","toResolveHierarchy","loadOne","load","_this5","prefix","_name$split3","_name$split4","log","saveMissing","namespace","fallbackValue","isUpdate","addResource"],"mappings":"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","sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/objectSpread\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport * as utils from './utils.js';\nimport baseLogger from './logger.js';\nimport EventEmitter from './EventEmitter.js';\n\nfunction remove(arr, what) {\n  var found = arr.indexOf(what);\n\n  while (found !== -1) {\n    arr.splice(found, 1);\n    found = arr.indexOf(what);\n  }\n}\n\nvar Connector =\n/*#__PURE__*/\nfunction (_EventEmitter) {\n  _inherits(Connector, _EventEmitter);\n\n  function Connector(backend, store, services) {\n    var _this;\n\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\n    _classCallCheck(this, Connector);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Connector).call(this));\n    EventEmitter.call(_assertThisInitialized(_assertThisInitialized(_this))); // <=IE10 fix (unable to call parent constructor)\n\n    _this.backend = backend;\n    _this.store = store;\n    _this.languageUtils = services.languageUtils;\n    _this.options = options;\n    _this.logger = baseLogger.create('backendConnector');\n    _this.state = {};\n    _this.queue = [];\n\n    if (_this.backend && _this.backend.init) {\n      _this.backend.init(services, options.backend, options);\n    }\n\n    return _this;\n  }\n\n  _createClass(Connector, [{\n    key: \"queueLoad\",\n    value: function queueLoad(languages, namespaces, options, callback) {\n      var _this2 = this;\n\n      // find what needs to be loaded\n      var toLoad = [];\n      var pending = [];\n      var toLoadLanguages = [];\n      var toLoadNamespaces = [];\n      languages.forEach(function (lng) {\n        var hasAllNamespaces = true;\n        namespaces.forEach(function (ns) {\n          var name = \"\".concat(lng, \"|\").concat(ns);\n\n          if (!options.reload && _this2.store.hasResourceBundle(lng, ns)) {\n            _this2.state[name] = 2; // loaded\n          } else if (_this2.state[name] < 0) {// nothing to do for err\n          } else if (_this2.state[name] === 1) {\n            if (pending.indexOf(name) < 0) pending.push(name);\n          } else {\n            _this2.state[name] = 1; // pending\n\n            hasAllNamespaces = false;\n            if (pending.indexOf(name) < 0) pending.push(name);\n            if (toLoad.indexOf(name) < 0) toLoad.push(name);\n            if (toLoadNamespaces.indexOf(ns) < 0) toLoadNamespaces.push(ns);\n          }\n        });\n        if (!hasAllNamespaces) toLoadLanguages.push(lng);\n      });\n\n      if (toLoad.length || pending.length) {\n        this.queue.push({\n          pending: pending,\n          loaded: {},\n          errors: [],\n          callback: callback\n        });\n      }\n\n      return {\n        toLoad: toLoad,\n        pending: pending,\n        toLoadLanguages: toLoadLanguages,\n        toLoadNamespaces: toLoadNamespaces\n      };\n    }\n  }, {\n    key: \"loaded\",\n    value: function loaded(name, err, data) {\n      var _name$split = name.split('|'),\n          _name$split2 = _slicedToArray(_name$split, 2),\n          lng = _name$split2[0],\n          ns = _name$split2[1];\n\n      if (err) this.emit('failedLoading', lng, ns, err);\n\n      if (data) {\n        this.store.addResourceBundle(lng, ns, data);\n      } // set loaded\n\n\n      this.state[name] = err ? -1 : 2; // consolidated loading done in this run - only emit once for a loaded namespace\n\n      var loaded = {}; // callback if ready\n\n      this.queue.forEach(function (q) {\n        utils.pushPath(q.loaded, [lng], ns);\n        remove(q.pending, name);\n        if (err) q.errors.push(err);\n\n        if (q.pending.length === 0 && !q.done) {\n          // only do once per loaded -> this.emit('loaded', q.loaded);\n          Object.keys(q.loaded).forEach(function (l) {\n            if (!loaded[l]) loaded[l] = [];\n\n            if (q.loaded[l].length) {\n              q.loaded[l].forEach(function (ns) {\n                if (loaded[l].indexOf(ns) < 0) loaded[l].push(ns);\n              });\n            }\n          });\n          /* eslint no-param-reassign: 0 */\n\n          q.done = true;\n\n          if (q.errors.length) {\n            q.callback(q.errors);\n          } else {\n            q.callback();\n          }\n        }\n      }); // emit consolidated loaded event\n\n      this.emit('loaded', loaded); // remove done load requests\n\n      this.queue = this.queue.filter(function (q) {\n        return !q.done;\n      });\n    }\n  }, {\n    key: \"read\",\n    value: function read(lng, ns, fcName) {\n      var _this3 = this;\n\n      var tried = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var wait = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 250;\n      var callback = arguments.length > 5 ? arguments[5] : undefined;\n      if (!lng.length) return callback(null, {}); // noting to load\n\n      return this.backend[fcName](lng, ns, function (err, data) {\n        if (err && data\n        /* = retryFlag */\n        && tried < 5) {\n          setTimeout(function () {\n            _this3.read.call(_this3, lng, ns, fcName, tried + 1, wait * 2, callback);\n          }, wait);\n          return;\n        }\n\n        callback(err, data);\n      });\n    }\n    /* eslint consistent-return: 0 */\n\n  }, {\n    key: \"prepareLoading\",\n    value: function prepareLoading(languages, namespaces) {\n      var _this4 = this;\n\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var callback = arguments.length > 3 ? arguments[3] : undefined;\n\n      if (!this.backend) {\n        this.logger.warn('No backend was added via i18next.use. Will not load resources.');\n        return callback && callback();\n      }\n\n      if (typeof languages === 'string') languages = this.languageUtils.toResolveHierarchy(languages);\n      if (typeof namespaces === 'string') namespaces = [namespaces];\n      var toLoad = this.queueLoad(languages, namespaces, options, callback);\n\n      if (!toLoad.toLoad.length) {\n        if (!toLoad.pending.length) callback(); // nothing to load and no pendings...callback now\n\n        return null; // pendings will trigger callback\n      }\n\n      toLoad.toLoad.forEach(function (name) {\n        _this4.loadOne(name);\n      });\n    }\n  }, {\n    key: \"load\",\n    value: function load(languages, namespaces, callback) {\n      this.prepareLoading(languages, namespaces, {}, callback);\n    }\n  }, {\n    key: \"reload\",\n    value: function reload(languages, namespaces, callback) {\n      this.prepareLoading(languages, namespaces, {\n        reload: true\n      }, callback);\n    }\n  }, {\n    key: \"loadOne\",\n    value: function loadOne(name) {\n      var _this5 = this;\n\n      var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n      var _name$split3 = name.split('|'),\n          _name$split4 = _slicedToArray(_name$split3, 2),\n          lng = _name$split4[0],\n          ns = _name$split4[1];\n\n      this.read(lng, ns, 'read', null, null, function (err, data) {\n        if (err) _this5.logger.warn(\"\".concat(prefix, \"loading namespace \").concat(ns, \" for language \").concat(lng, \" failed\"), err);\n        if (!err && data) _this5.logger.log(\"\".concat(prefix, \"loaded namespace \").concat(ns, \" for language \").concat(lng), data);\n\n        _this5.loaded(name, err, data);\n      });\n    }\n  }, {\n    key: \"saveMissing\",\n    value: function saveMissing(languages, namespace, key, fallbackValue, isUpdate) {\n      var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n\n      if (this.backend && this.backend.create) {\n        this.backend.create(languages, namespace, key, fallbackValue, null\n        /* unused callback */\n        , _objectSpread({}, options, {\n          isUpdate: isUpdate\n        }));\n      } // write to store to avoid resending\n\n\n      if (!languages || !languages[0]) return;\n      this.store.addResource(languages[0], namespace, key, fallbackValue);\n    }\n  }]);\n\n  return Connector;\n}(EventEmitter);\n\nexport default Connector;"]},"metadata":{},"sourceType":"module"}